<html>
<head>
    <title>Test Promises Mechanism</title>

    <script src="creojs.js"></script>
    <creojs src="browser.creojs"></creojs>

    <creojs id="modeldata.js">
        function getModelNames () {
            const session = pfcGetCurrentSession ();
            if (session.CurrentModel.Type === pfcModelType.MDL_ASSEMBLY) throw "the current model type is assembly"
            return session.ListModels ().map (m => m.FileName)      
        }
        function getFeatures (models) {
            const session = pfcGetCurrentSession ();
            return models.map (name => {return {name, csys: session.GetModelFromFileName (name).ListFeaturesByType (true, pfcFeatureType.FEATTYPE_COORD_SYS).length}})
        }
    </creojs>

    <script>
        function doit () {
            CreoJS.getModelNames ()
                .then (function (names) {return CreoJS.getFeatures (names)})
                .then (function (values) {alert (JSON.stringify (values.reduce (
                    function (acc, value) {
                        acc.models++
                        acc.csys += value.csys
                        return acc
                    },
                    {models:0, csys: 0}
                )))})
                .catch (function (ex) {alert ('Problem: ' + ex)})
            }
    </script>

</head>

<body>
    <button onclick="doit ()">Count Coord Systems for All Session models</button> but throw an exception if the current model is assembly
</body>
</html>